/* ng-infinite-scroll - v1.0.0 - 2013-02-23 */
var mod;
mod=angular.module("infinite-scroll",[]),
    mod.directive("infiniteScroll",["$rootScope","$window","$timeout",
        function(i,n,e){return{link:function(t,l,o)
        {var r,c,f,a;return n=angular.element(n),f=0,
            null!=o.infiniteScrollDistance&&t.$watch(o.infiniteScrollDistance,
                function(i){return f=parseInt(i,10)}),
            a=!0,r=!1,null!=o.infiniteScrollDisabled&&t.$watch(o.infiniteScrollDisabled,
            function(i){return a=!i,a&&r?(r=!1,c()):void 0}),
            c=function(){var e,c,u,d;return d=n.height()+n.scrollTop(),
                e=l.offset().top+l.height(),c=e-d,u=n.height()*f>=c,
                    u&&a?i.$$phase?t.$eval(o.infiniteScroll):t.$apply(o.infiniteScroll):u?r=!0:void 0},
            n.on("scroll",c),t.$on("$destroy",
            function(){return n.off("scroll",c)}),
            e(function(){return o.infiniteScrollImmediateCheck?t.$eval(o.infiniteScrollImmediateCheck)?c():void 0:c()},
                0)}}}]);
//var ftitAppModule = angular.module('ftitApp', ['infinite-scroll']);

app.controller('PostListController',
    function ($scope, Demo) {
        $scope.demo = new Demo();
        //alert("ddf");
    });

// 创建后台数据交互工厂
app.factory('Demo', function ($http) {
//    alert("ddf");
    var Demo = function () {
        this.items = [];
        this.busy = false;
        this.after = '';
        this.page = 0;
    };

    Demo.prototype.nextPage = function () {
        alert("ddf");
        if (this.busy) return;
        this.busy = true;

        // var url = "http://192.168.3.95:7002/api/post/nextpage?id=" + this.page + "&callback=JSON_CALLBACK";
        $http.jsonp(SETTING.ApiUrl+'/Task/TaskListMobile/',{params:this.page,'withCredentials':true}).success(function (data) {
            var items = data;
            console.log(data);
            alert(data);
            for (var i = 0; i < items.length; i++) {
                this.items.push(items[i]);
            }
            this.after = "t3_" + this.items[this.items.length - 1].id;
            this.busy = false;
            this.page += 1;
        }.bind(this));
    };

    return Demo;
});